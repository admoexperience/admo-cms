<section>
  <a href="#" class="new">+</a>
  <h2>Content Management</h2>

  <ul>
    <% @app.config.each do |key, value|
      url = view_content_path(@app,key)
      current_page = current_page?(url)

      %>
    <%= content_tag :li, :class=>active_class?(current_page) do
      link_to url do%>
      <%= value[:title] || 'unkown'%><%
      end
    end
    end%>
  </ul>
</section>

<div id="content">
  <h2><%= @app.name %></h2>

  <div class="portlet active">
    <div class="links">
      <a href="#" class="edit disabled" title="Edit"></a>
      <a href="#" class="delete" title="Delete"></a>
    </div>

    <form>
      <div class="input-block">
        <label for="title">Title</label>
        <%= text_field_tag :title, @app.config[@current_content][:title] %>
      </div>

      <div class="input-block">
        <label for="descriptiong">Description</label>
        <%= text_area_tag :description, @app.config[@current_content][:description] %>
      </div>

      <div class="input-block left">
        <label>Image</label>
        <div id="image-div" class="image present" style="background-image: url(<%= @app.find_image(@current_content).thumb_url %>)">
          <input class="file-input" id="image_upload" name="upload" type="file"></input>
          <div class="progress"><div class="bar"></div></div>
        </div>
      </div>

      <div class="input-block right">
        <label>Video</label>
        <div id="video-div" class="video">
          <input class="file-input" id="video_upload" name="upload" type="file"></input>
          <div class="progress"><div class="bar"></div></div>
        </div>
      </div>
      <button type="button" class="cancel">Cancel</button>
      <button type="submit" class="proceed">Publish</button>

    </form>
  </div>
</div>


<script>
$(function () {

    $(['#video_upload','#image_upload']).each(function(key,value){
      $(value).fileupload({
        dataType: 'json',
        formData: [ { name: 'authenticity_token', value: $('meta[name="csrf-token"]').attr('content') } ],
         url: '<%= update_content_item_path( @app,@current_content, @app.find_image(@current_content) )%>',
         progressall: function (e, data) {
          var progress = parseInt(data.loaded / data.total * 100, 10);
          $('.progress .bar',value).css(
              'width',
              progress + '%'
          );
      },
      done: function (e, data) {
        console.log(data);
        console.log(data.result);
        var file = data.result[0];
        $(value).css('background-image','url('+file.thumbnail_url+')');
      }
    });
    });
});
</script>
